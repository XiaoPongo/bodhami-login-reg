<div class="manage-container">
  <!-- Left Panel: Class List -->
  <div class="left-panel">
    <div class="panel-header">
      <h2>Your Classrooms</h2>
      <button class="btn btn-primary" (click)="openCreateModal()">
        <i class="fas fa-plus"></i> New Class
      </button>
    </div>
    <div class="class-list-scroll">
      <ng-container *ngIf="(classes$ | async) as classes; else loadingClasses">
        <div *ngIf="classes.length > 0; else noClasses">
          <div 
            *ngFor="let class of classes" 
            class="class-card"
            [class.selected]="(selectedClass$ | async)?.id === class.id"
            (click)="handleSelectClass(class.id)">
            <div class="class-card-header">
              <span class="class-name">{{ class.name }}</span>
              <span class="class-code">{{ class.classCode }}</span>
            </div>
            <p class="class-description">{{ class.description | slice:0:100 }}{{ class.description.length > 100 ? '...' : '' }}</p>
            <div class="class-card-footer">
              <span><i class="fas fa-users"></i> {{ class.students?.length ?? 0 }}</span>
              <span><i class="fas fa-file-alt"></i> {{ (class.materials?.length ?? 0) + (class.activities?.length ?? 0) }}</span>
            </div>
          </div>
        </div>
        <ng-template #noClasses>
          <div class="empty-state">
            <p>No classes yet. <br> Click "New Class" to start.</p>
          </div>
        </ng-template>
      </ng-container>
      <ng-template #loadingClasses>
        <div class="class-card placeholder" *ngFor="let i of [1,2,3]"></div>
      </ng-template>
    </div>
  </div>

  <!-- Right Panel: Class Details -->
  <div class="right-panel">
    <ng-container *ngIf="(selectedClass$ | async) as selectedClass; else noClassSelected">
      <div class="detail-header">
        <div>
          <h1>{{ selectedClass.name }}</h1>
          <p>{{ selectedClass.description }}</p>
        </div>
        <div class="header-actions">
          <div class="code-box" (click)="copyCode(selectedClass.classCode)" title="Copy Join Code">
            <span>{{ selectedClass.classCode }}</span>
            <i class="fas fa-copy"></i>
          </div>
          <button class="btn btn-danger" (click)="handleDeleteClass(selectedClass.id, selectedClass.name)">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>

      <!-- Content Tabs -->
      <div class="content-tabs">
        <button [class.active]="activeContentTab === 'students'" (click)="setActiveTab('students')">
          <i class="fas fa-users"></i> Enrolled Students
        </button>
        <button [class.active]="activeContentTab === 'materials'" (click)="setActiveTab('materials')">
          <i class="fas fa-folder-open"></i> Materials
        </button>
        <button [class.active]="activeContentTab === 'activities'" (click)="setActiveTab('activities')">
          <i class="fas fa-gamepad"></i> Activities
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Students Tab -->
        <div *ngIf="activeContentTab === 'students'">
          <!-- Student list will go here -->
          <p class="placeholder-text">Student management coming soon.</p>
        </div>
        <!-- Materials Tab -->
        <div *ngIf="activeContentTab === 'materials'">
           <p class="placeholder-text">Material management coming soon.</p>
        </div>
        <!-- Activities Tab -->
        <div *ngIf="activeContentTab === 'activities'">
          <p class="placeholder-text">Activity management coming soon.</p>
        </div>
      </div>
    </ng-container>
    
    <ng-template #noClassSelected>
      <div class="empty-state-large">
        <i class="fas fa-mouse-pointer"></i>
        <h2>Select a Class</h2>
        <p>Choose a class from the list to view its details.</p>
      </div>
    </ng-template>
  </div>
</div>

<!-- Modal for creating a new class -->
<div *ngIf="isCreateModalOpen" class="modal-overlay" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Create New Class</h3>
      <button class="btn-close" (click)="closeCreateModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form #createClassForm="ngForm" (ngSubmit)="handleCreateClass()">
        <div class="input-group">
          <label for="newClassName">Class Name *</label>
          <input type="text" id="newClassName" [(ngModel)]="newClassName" name="newClassName" required>
        </div>
        <div class="input-group">
          <label for="newClassDescription">Description</label>
          <textarea id="newClassDescription" [(ngModel)]="newClassDescription" name="newClassDescription" rows="4"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="!newClassName.trim()">Create Class</button>
        </div>
      </form>
    </div>
  </div>
</div>

