<div class="form-container">
    <h2>Create Mission</h2>
  
    <!-- ====== NEW: Guidelines Section ====== -->
    <div class="guidelines-box">
      <i class="fas fa-info-circle"></i>
      <div>
        <strong>Quick Guide:</strong>
        <p>Start with a title and description, then build your content. You can add multiple passages, scenarios, and questions. Finally, assign the mission to one or more classes.</p>
      </div>
    </div>
  
    <form #missionForm="ngForm" (ngSubmit)="onSubmit()">
      <!-- Basic Info Section -->
      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-clipboard-list"></i>
          <h3>Basic Info</h3>
        </div>
        <div class="form-group">
          <label for="missionTitle">Mission Title *</label>
          <input type="text" id="missionTitle" name="missionTitle" [(ngModel)]="mission.title" required placeholder="e.g., The Amazon Rainforest Expedition">
        </div>
        <div class="form-group">
          <label for="missionDescription">Mission Description</label>
          <textarea id="missionDescription" name="missionDescription" [(ngModel)]="mission.description" placeholder="Provide a brief overview of the mission..."></textarea>
        </div>
        <div class="form-group">
          <label for="xpAllotment">XP Allotment</label>
          <input type="number" id="xpAllotment" name="xpAllotment" [(ngModel)]="mission.xp" placeholder="e.g., 100">
        </div>
      </div>
  
      <!-- Content Builder Section -->
      <div class="form-section">
        <div class="section-header">
          <i class="fas fa-cubes"></i>
          <h3>Content Builder</h3>
        </div>
  
        <!-- Passages -->
        <div class="form-group">
          <label>Passages</label>
          <div *ngFor="let passage of mission.passages; let i = index" class="dynamic-list-item">
            <input type="text" [(ngModel)]="mission.passages[i]" [name]="'passage' + i" placeholder="Enter passage text...">
            <button type="button" class="btn btn-remove" (click)="removePassage(i)" title="Remove Passage">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
          <button type="button" class="btn btn-add" (click)="addPassage()"><i class="fas fa-plus"></i> Add Passage</button>
        </div>
  
        <!-- Scenarios -->
        <div class="form-group">
          <label>Scenarios</label>
          <div *ngFor="let scenario of mission.scenarios; let i = index" class="scenario-block">
            <textarea [(ngModel)]="scenario.description" [name]="'scenarioDesc' + i" placeholder="Describe the scenario..."></textarea>
            <div *ngFor="let answer of scenario.answers; let j = index" class="dynamic-list-item">
              <input type="text" [(ngModel)]="scenario.answers[j]" [name]="'answer' + i + j" [placeholder]="'Answer ' + (j + 1)">
              <button type="button" class="btn btn-remove" (click)="removeAnswer(i, j)" title="Remove Answer">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
            <div class="scenario-actions">
               <button type="button" class="btn btn-add-answer" (click)="addAnswer(i)"><i class="fas fa-plus"></i> Add Answer</button>
               <button type="button" class="btn btn-remove-scenario" (click)="removeScenario(i)" title="Remove Scenario">
                  <i class="fas fa-trash-alt"></i> Remove Scenario
               </button>
            </div>
          </div>
          <button type="button" class="btn btn-add" (click)="addScenario()"><i class="fas fa-plus"></i> Add Scenario</button>
        </div>
      </div>
  
      <!-- Class Assignment Section -->
      <div class="form-section">
         <div class="section-header">
          <i class="fas fa-chalkboard-teacher"></i>
          <h3>Class Assignment</h3>
        </div>
        <div class="form-group">
          <label for="chapterSelect">Select Chapter</label>
          <select id="chapterSelect" name="chapter" [(ngModel)]="mission.chapter">
            <option value="" disabled>-- Select a Chapter --</option>
            <option *ngFor="let chapter of chapters" [value]="chapter">{{ chapter }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Assign to Classes *</label>
          <div class="class-selection-container">
            <div *ngFor="let class of availableClasses" class="class-item">
               <input type="checkbox" [id]="'class-' + class.id" [value]="class.id" (change)="onClassChange($event)">
               <label [for]="'class-' + class.id">{{ class.name }}</label>
            </div>
          </div>
        </div>
      </div>
  
      <!-- ====== MOVED: Main Form Actions to the end ====== -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary">
          <i class="fas fa-eye"></i> Preview
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="missionForm.invalid">
          <i class="fas fa-paper-plane"></i> Submit Mission
        </button>
      </div>
    </form>
  </div>
  
  